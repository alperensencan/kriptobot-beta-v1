<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kriptobot - Piyasa</title>

  <style>
    body{
      font-family:system-ui,Arial;
      margin:24px;
      background:#0b0e11;
      color:#eaecef;
    }

    h2{
      color:#f3ba2f;
    }

    table{
      border-collapse:collapse;
      width:100%;
      max-width:1000px;
      background:#181a20;
    }

    th,td{
      border:1px solid #2b2f36;
      padding:10px;
      text-align:left;
    }

    th{
      background:#2b2f36;
      color:#aaa;
    }

    .muted{
      opacity:.7;
    }

    .loading{
      color:#f3ba2f;
      font-weight:bold;
    }

    .footer{
      margin-top:40px;
      font-size:12px;
      opacity:.6;
    }
  </style>
</head>

<body>

<h2>Kriptobot Piyasa Terminal</h2>

<div id="status" class="muted loading">
Loading market data...
</div>

<br>

<table>
  <thead>
  <tr>
    <th>Sembol</th>
    <th>Fiyat</th>
    <th>Değişim</th>
    <th>Sinyal</th>
    <th>Confidence</th>
    <th>Rejim</th>
  </tr>
  </thead>

  <tbody id="rows"></tbody>
</table>

<div class="footer">
This page contains estimated analysis. Not financial advice.
</div>

<script>

let firstLoad = true;

async function load() {

  const status = document.getElementById('status');
  const rows = document.getElementById('rows');

  try {

    if(firstLoad){
      status.innerHTML = "Loading market data...";
    }

    const res = await fetch('/api/piyasa?ts=' + Date.now(), {
      cache: "no-store"
    });

    if (!res.ok) throw new Error("HTTP " + res.status);

    const data = await res.json();

    if (!Array.isArray(data) || data.length === 0) {
      status.innerHTML = "No market data received";
      return;
    }

    rows.innerHTML = "";

    data.forEach(c => {

      const tr = document.createElement('tr');

      const signalColor = c.sigColor || "#888";

      tr.innerHTML = `
        <td>${c.symbol || "-"}</td>
        <td>${c.price || "-"}</td>
        <td>${c.change || "-"}</td>
        <td style="font-weight:bold;color:${signalColor}">
            ${c.signal || "NEUTRAL"}
        </td>
        <td>${c.confidence || "0"}</td>
        <td>${c.regime || "-"}</td>
      `;

      rows.appendChild(tr);
    });

    status.innerHTML = "Live • " + new Date().toLocaleTimeString();

    firstLoad = false;

  } catch (e) {

    console.error(e);

    status.innerHTML = "API Error → " + e.message;
  }
}

load();

/* 15 saniyede bir refresh */
setInterval(load, 15000);

</script>

</body>
</html>
